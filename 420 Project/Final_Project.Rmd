---
title: "House data research at Saratoga, New York"
author: "Aplus Group"
output:
  html_document:
    theme: readable
    toc: yes
---
# Introduction

## Description
Rebecca and Haofei are Psychology student and Linda is from Gies College of Business. We are all born in China. In China, housing price is super high compared to the income of an average individual. Many factors including heavy financial bubbles in the capital market have result in the high price of properties. We are all curious of factors that influence the housing price in the United States. This dataset from [The Data And Story Library](https://dasl.datadescription.com/) contains the housing price at Saratoga, New York, as well as seven attributes of the property. We are going to find the best predictors of the housing price, while the model with all predictors seems to be insufficient due to violation of equal variance and normality... We are trying to find the composition of the housing price.

This dataset contains 1057 observations and 8 variables.

**Numerical Response**

- `Price`: The price of this property in U.S. dollars.

**Numerical Predictors**

- `Living.Area`: The size of this property in square feet.
- `Bathrooms`: Number of bathrooms in this property.
- `Bedrooms`: Number of bedrooms in this property.
- `Fireplaces`: Number of fireplaces in this property.
- `Lot.Size`: The total area of a property, including the yard up to the boundaries (property line) in arce.
- `Age`: The age of the property.

**Factor Predictor**

- `Fireplace`: Whether there is a fireplace in the house.

# Methods

## Preparation of Data
```{r}
library(readr)
#install.packages("Hmisc")
library(Hmisc)
#install.packages("leaps", "https://cloud.r-project.org/")
library(leaps)
```


```{r}
housing = read.csv("housing-prices.csv")
housing$Fireplace = as.factor(housing$Fireplace)
str(housing)
```

We converted the Fireplace variable from logical to the factor type. Factor level 1 stands for no presence of fireplace (FALSE). Factor level 2 stands for presence of fireplace (TRUE).

```{r}
sum(is.na(housing))
apply(is.na(housing), 2, which)

hist(housing$Lot.Size)
housing$Lot.Size[is.na(housing$Lot.Size)] = median(housing$Lot.Size, na.rm = T)
```

We identified the number of missing values for this dataset. The results show all 9 missing values to be under the Lot.size category. After ploting the histogram of the Lot.Size variable, we examine small variation with most of the data in range from 0 - 1 (unit). Therefore, in order to fix the mssing values, we have decided to impute the overall median score in replace for the absent 9 data values.

```{r}
plot(Price ~ Living.Area, data = housing)
plot(Price ~ Bathrooms, data = housing)
plot(Price ~ Bedrooms, data = housing)
plot(Price ~ Fireplaces, data = housing)
plot(Price ~ Lot.Size, data = housing)
plot(Price ~ Fireplace, data = housing)
```


## Multiple Linear Regression
```{r}
housing_mod_mlr = lm(Price ~., data = housing)
summary(housing_mod_mlr)
summary(housing_mod_mlr)$adj.r.squared
anova(housing_mod_mlr)
car::vif(housing_mod_mlr)

hist(resid(housing_mod_mlr),
     xlab   = "Residuals",
     main   = "Histogram of Residuals",
     col    = "darkorange",
     border = "dodgerblue",
     breaks = 25)

qqnorm(resid(housing_mod_mlr), col = "dodgerblue")
qqline(resid(housing_mod_mlr), col = "darkorange", lwd = 2)
plot(fitted(housing_mod_mlr), resid(housing_mod_mlr))
abline(h = 0, col = "purple", lwd = 3)
```

```{r}
housing_mod_back_aic = step(housing_mod_mlr, direction = "backward", trace = 0)
car::vif(housing_mod_back_aic)

qqnorm(resid(housing_mod_back_aic), col = "dodgerblue")
qqline(resid(housing_mod_back_aic), col = "darkorange", lwd = 2)
plot(fitted(housing_mod_back_aic), resid(housing_mod_back_aic))
abline(h = 0, col = "purple", lwd = 3)

anova(housing_mod_back_aic, housing_mod_mlr)
```
```{r}
sub = summary(regsubsets(Price ~., data = housing))
sub$which
sub$rss
sub$adjr2
best_r2 = which.max(sub$adjr2)

n = length(resid(housing_mod_mlr))
p = length(coef(housing_mod_mlr))
sub_aic = (n * log(sub$rss / n) + 2 * (2:p))
sub$which[which.min(sub_aic), ]
```


```{r}
housing_mod_back_bic = step(housing_mod_mlr, direction = "backward", k = log(n), trace = 0)
summary(housing_mod_back_bic)

qqnorm(resid(housing_mod_back_bic), col = "dodgerblue")
qqline(resid(housing_mod_back_aic), col = "darkorange", lwd = 2)
plot(fitted(housing_mod_back_aic), resid(housing_mod_back_aic))
abline(h = 0, col = "purple", lwd = 3)

anova(housing_mod_back_bic, housing_mod_back_aic)
```

- The test statistic: $F$ = 5.3528\
- The distribution of the test statistic under the null hypothesis: $F$ distribution with df = 1 and 1051. \
- The p-value: $p$ = 0.02088\
- A decision: We reject the null hypothesis under the significance $\alpha = 0.05$.\ The model selected by backward AIC variable selection is better. \

```{r}
summary(housing_mod_back_aic)$adj.r.squared
summary(housing_mod_back_bic)$adj.r.squared
```

Also seen by the larger adjusted R^2, the better model is the model with backward AIC variable selection.

```{r}
mod2 = lm(Price ~ Living.Area + Bathrooms + Bedrooms + Fireplaces + Age + Bathrooms:Bedrooms, data = housing)
summary(mod2)$adj.r.squared

anova(housing_mod_mlr,mod2)
```

Also seen by the larger adjusted R^2, the better model is the model with backward AIC variable selection.

## Interaction
```{r}
#interaction

housing_mod_int = lm(Price ~ Living.Area * Bathrooms * Bedrooms * Fireplaces * Age * Lot.Size * Fireplace, data = housing)
summary(housing_mod_int)$adj.r.squared

qqnorm(resid(housing_mod_int), col = "dodgerblue")
qqline(resid(housing_mod_int), col = "darkorange", lwd = 2)
plot(fitted(housing_mod_int), resid(housing_mod_int))
abline(h = 0, col = "purple", lwd = 3)


n = length(resid(housing_mod_int))
housing_mod_int_bic = step(housing_mod_int, direction = "backward", k = log(n), trace = 0)
anova(housing_mod_int_bic, housing_mod_int_aic)

summary(housing_mod_int_bic)$adj.r.squared
anova(housing_mod_back_aic, housing_mod_int_bic)

#mod3 = lm(Price ~ Living.Area * Bathrooms, data = housing)
#summary(mod3)

#mod4 = lm(Price ~ Living.Area + Bathrooms + Bedrooms + Fireplaces + Lot.Size + Age + Fireplace + Living.Area:Bathrooms + Living.Area:Bathrooms:Bedrooms, data = housing)

#anova(mod3,mod4)

#mod4 = lm(Price ~ Living.Area + Bathrooms + Bedrooms + Fireplaces + Lot.Size + Age + Fireplace + Living.Area:Bathrooms, data = housing)

# Living.Area:Bathrooms:Age
# Living.Area:Fireplaces:Age
```
```{r}
housing_mod_int_aic = step(housing_mod_int, direction = "backward", trace = 0)
summary(housing_mod_int_aic)$adj.r.squared
```

```{r}
n = length(resid(housing_mod_int))
housing_mod_int_bic = step(housing_mod_int, direction = "backward", k = log(n), trace = 0)
summary(housing_mod_int_bic)$adj.r.squared

anova(housing_mod_int_bic, housing_mod_int_aic)
anova(housing_mod_int_aic, housing_mod_int)
```

The addictive model of all variables does not show to be a good model for representing the housing price. As we can see the normality assumption is violated. In addition, we also see the equal variance assumption being violated since the result from the `bptest` is small.

## Transformation
```{r}
mlr_log = lm(log(Price) ~ Living.Area + Bathrooms + Age, data = housing)
summary(mlr_log)
sqrt(mean(resid(mlr_log)^2))

mlr = lm(Price ~ Living.Area + Bathrooms + Age, data = housing)
summary(mlr)
sqrt(mean(resid(mlr)^2))
```
In this transformation, transforming the response to log(Price) will produce a better model which has a lower `RMSE`. We found that the number of bedrooms and the presence of fireplaces is not important, since their relation with price is not significant. We guess it is because multiple bedrooms can't make a greater house. Also, fireplaces are outdated recent years and people are using air conditioner instead. However, there may be a relation between them with other attributes other than price.

```{r}
age_fire = lm(Age ~ Fireplaces, data = housing)
summary(age_fire)
plot(Age ~ Fireplaces,
     data = housing,
     col = "dodgerblue", pch = 20, cex = 1.5)
abline(age_fire, col = "darkorange", lwd = 2)
sqrt(mean(resid(age_fire)^2))

bedroom_bathroom = lm(log(Bedrooms) ~ log(Bathrooms), data = housing)
summary(bedroom_bathroom)
plot(log(Bedrooms) ~ log(Bathrooms),
     data = housing,
     col = "dodgerblue", pch = 20, cex = 1.5)
abline(bedroom_bathroom, col = "darkorange", lwd = 2)
sqrt(mean(resid(bedroom_bathroom)^2))
```
# Result
## Predicting Housing Price
Hello

# Discussion

# Appendix

## Team Members
Name                    NetID
------------            --------
Rebecca (YaoJia) Chen   [yrchen2](mailto:yrchen2@illinois.edu)
Haofei Xu               [haofeix2](mailto:haofeix2@illinois.edu)
Linda (Xinyi) Yuan      [xinyiy6](mailto:xinyiy6@illinois.edu)
------------            --------